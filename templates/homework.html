<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>作业公告板</title>
    <link rel="stylesheet" href="/static/css/homework.css">
    <!-- Font Awesome 图标 -->
    <link rel="stylesheet" href="/static/fontawesome-free-6.4.0-web/css/all.min.css">
    <script src="/static/js/homework.js"></script>
</head>
<body>
    <div class="container">
        <button class="home-button" onclick="location.href='/'">主页</button>
        
        <h1>人大附中三亚学校高一(4)班作业公告板</h1>
        <div class="top-buttons">
            <button onclick="window.open('/homework/publish', '_blank')">添加作业</button>
            <button onclick="openSettings()">设置</button>
            <button onclick="toggleFullscreen()">全屏</button>
        </div>
        
        <div class="columns" id="homeworkContainer">
            {% if submissions %}
                {% for subject, subject_submissions in submissions.items() %}
                <div class="subject-section">
                    <div class="subject-title">{{ subject }}</div>
                    <ul class="homework-list">
                        {% for submission in subject_submissions %}
                        <li class="homework-item" data-deadline="{{ submission.deadline }}">
                            <div class="content-wrapper">
                                <span class="content">{{ submission.content | replace('\r\n', '
') | replace('\n', '
') | replace('\r', '
') }}</span>
                                <span class="labels">
                                    {% for label_name in submission.labels %}
                                        {% set label_obj = (labels | selectattr('name', 'equalto', label_name) | first) %}
                                        <span class="label-tag" {% if label_obj %}style="background-color: {{ label_obj.color }}"{% endif %}>{{ label_name }}</span>
                                    {% endfor %}
                                </span>
                            </div>
                            <div class="dates-container">
                                <div class="deadline">截止日期: {{ submission.deadline[5:] }}</div>
                                <div class="timestamp">发布时间: {{ submission.timestamp[5:-3] }}</div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-submissions">暂无作业信息</div>
            {% endif %}
        </div>
    </div>

    <!-- 设置弹窗 -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSettings()">&times;</span>
            <h2>设置</h2>
            <div class="setting-group">
                <label for="refreshInterval">刷新间隔（秒）：</label>
                <input type="number" id="refreshInterval" min="10" max="3600" value="60">
            </div>
            <div class="setting-group">
                <label for="fontSize">字体大小：</label>
                <select id="fontSize">
                    <option value="15">小</option>
                    <option value="20" selected>中</option>
                    <option value="26">大</option>
                    <option value="34">超大</option>
                </select>
            </div>
            <div class="setting-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="hideExpired">
                    <label for="hideExpired">不显示已截止的作业</label>
                </div>
            </div>
            <div class="setting-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="EditButton">
                    <label for="EditButton">显示编辑按钮</label>
                </div>
            </div>
            <div class="setting-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="DeleteButton">
                    <label for="DeleteButton">显示删除按钮</label>
                </div>
            </div>
            <div class="setting-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="quickPublishButton">
                    <label for="quickPublishButton"><s>显示快捷布置作业按钮</s>（未完工，尚不可用）</label>
                </div>
            </div>
            <button class="save-settings" onclick="saveSettings()">保存设置</button>
        </div>
    </div>

    <!-- 在页面底部添加快捷布置作业弹窗 -->
    <div id="quickPublishModal" class="modal">
        <div class="modal-content quick-publish-modal">
            <span class="close" onclick="closeQuickPublishModal()">&times;</span>
            <h2>快捷布置作业</h2>
            
            <form id="quickPublishForm">
                <!-- 学科选择 -->
                <div class="form-group">
                    <label for="quickSubject">学科：</label>
                    <select id="quickSubject" class="form-control">
                        {% for subject in subjects %}
                        <option value="{{ subject.name }}">{{ subject.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- 作业内容 -->
                <div class="form-group">
                    <label for="quickContent">作业内容：</label>
                    <textarea id="quickContent" class="form-control" rows="3" placeholder="请输入作业内容..."></textarea>
                </div>
                
                <!-- 常用词宫格 -->
                <div class="form-group">
                    <label>常用词：</label>
                    <div class="common-words-grid" id="commonWordsGrid">
                        <!-- 常用词将通过JavaScript动态生成 -->
                    </div>
                </div>
                
                <!-- 标签选择 -->
                <div class="form-group">
                    <label for="quickLabels">标签：</label>
                    <select id="quickLabels" class="form-control" multiple>
                        {% for label in labels %}
                        <option value="{{ label.id }}">{{ label.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- 截止日期快捷选择 -->
                <div class="form-group">
                    <label>截止日期：</label>
                    <div class="date-quick-buttons">
                        <button type="button" class="date-btn" onclick="setQuickDate('today')">今日</button>
                        <button type="button" class="date-btn" onclick="setQuickDate('tomorrow')">明日</button>
                        <button type="button" class="date-btn" onclick="setQuickDate('custom')">其他日期</button>
                        <button type="button" class="date-btn clear" onclick="clearQuickDate()">清空</button>
                    </div>
                    <input type="date" id="quickDeadline" class="form-control" style="display: none;">
                </div>
                
                <!-- 提交按钮 -->
                <div class="form-buttons">
                    <button type="button" class="btn-cancel" onclick="closeQuickPublishModal()">取消</button>
                    <button type="button" class="btn-submit" onclick="submitQuickPublish()">发布</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 第二个快捷布置弹窗 -->
    <div id="quickPublishModal2" class="modal">
        <div class="modal-content quick-publish-modal">
            <span class="close" onclick="closeQuickPublishModal2()">&times;</span>
            <h2>快捷布置作业 (2)</h2>
            
            <form id="quickPublishForm2">
                <!-- 学科选择 -->
                <div class="form-group">
                    <label for="quickSubject2">学科：</label>
                    <select id="quickSubject2" class="form-control">
                        {% for subject in subjects %}
                        <option value="{{ subject.name }}">{{ subject.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- 作业内容 -->
                <div class="form-group">
                    <label for="quickContent2">作业内容：</label>
                    <textarea id="quickContent2" class="form-control" rows="3" placeholder="请输入作业内容..."></textarea>
                </div>
                
                <!-- 常用词宫格 -->
                <div class="form-group">
                    <label>常用词：</label>
                    <div class="common-words-grid" id="commonWordsGrid2">
                        <!-- 常用词将通过JavaScript动态生成 -->
                    </div>
                </div>
                
                <!-- 标签选择 -->
                <div class="form-group">
                    <label for="quickLabels2">标签：</label>
                    <select id="quickLabels2" class="form-control" multiple>
                        {% for label in labels %}
                        <option value="{{ label.id }}">{{ label.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- 截止日期快捷选择 -->
                <div class="form-group">
                    <label>截止日期：</label>
                    <div class="date-quick-buttons">
                        <button type="button" class="date-btn" onclick="setQuickDate2('today')">今日</button>
                        <button type="button" class="date-btn" onclick="setQuickDate2('tomorrow')">明日</button>
                        <button type="button" class="date-btn" onclick="setQuickDate2('custom')">其他日期</button>
                        <button type="button" class="date-btn clear" onclick="clearQuickDate2()">清空</button>
                    </div>
                    <input type="date" id="quickDeadline2" class="form-control" style="display: none;">
                </div>
                
                <!-- 提交按钮 -->
                <div class="form-buttons">
                    <button type="button" class="btn-cancel" onclick="closeQuickPublishModal2()">取消</button>
                    <button type="button" class="btn-submit" onclick="submitQuickPublish2()">发布</button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>